<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>2XKO Overlay</title>
<style>
html,body{width:100%;height:100%;margin:0;background:transparent;display:flex;justify-content:center;align-items:center;font-family:'Swiss 721',Arial,sans-serif}
#app{display:flex}
#stickWrapper{width:220px;height:220px;position:absolute;top:300px;left:60px;background:rgba(0,0,0,0.8);border-radius:50%}
#stickCanvas{width:100%;height:100%;display:block;background:transparent}
#joystickHead{position:absolute;width:60px;height:60px;border-radius:50%;border:10px solid #000;transform:translate(-50%,-50%) scale(1);pointer-events:none;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:30px;transition:left .01s,top .01s,transform .1s;background:rgba(160,160,160,1)}
#directionMarkers{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none}
.marker{position:absolute;width:10px;height:10px;border-radius:50%;background:rgba(80,80,80,1);transform:translate(-50%,-50%);transition:all .1s}
.marker.active{background:rgba(255,255,255,1);width:20px;height:20px}
.buttons{position:relative;width:300px;height:300px}
.btn{position:absolute;width:90px;height:90px;display:flex;align-items:center;justify-content:center;font-size:40px;text-transform:uppercase;transition:.05s;border-radius:50%;border:10px solid #000;box-shadow:0 2px 6px rgba(0,0,0,.25);font-family:'Swiss 721',Arial,sans-serif;filter:brightness(.6);overflow:hidden;text-align:center;white-space:nowrap}
.btn.active{filter:brightness(1);transform:scale(1.05)}
</style>
</head>
<body>
<div id="app">
  <div id="stickWrapper">
    <div id="directionMarkers">
      <div class="marker" id="marker0"></div>
      <div class="marker" id="marker1"></div>
      <div class="marker" id="marker2"></div>
      <div class="marker" id="marker3"></div>
      <div class="marker" id="marker4"></div>
      <div class="marker" id="marker5"></div>
      <div class="marker" id="marker6"></div>
      <div class="marker" id="marker7"></div>
    </div>
    <canvas id="stickCanvas"></canvas>
    <div id="joystickHead"></div>
  </div>
  <div class="controls">
    <div class="buttons" id="buttonGrid"></div>
  </div>
</div>

<script>
const c={d:0.1,t:15,i:false,bS:{bC:"#000",aC:"rgba(225,225,225,1)",dC:"rgba(160,160,160,1)"},b:[{id:"A",t:240,l:280,lbl:"T",c:"rgba(200,200,200,1)"},{id:"B",t:120,l:280,lbl:"H",c:"rgba(200,200,200,1)"},{id:"X",t:120,l:40,lbl:"L",c:"rgba(200,200,200,1)"},{id:"Y",t:120,l:160,lbl:"M",c:"rgba(200,200,200,1)"},{id:"LB",t:240,l:400,lbl:"P",c:"rgba(200,200,200,1)"},{id:"RB",t:120,l:400,lbl:"D",c:"rgba(200,200,200,1)"},{id:"LT",t:240,l:40,lbl:"S1",c:"rgba(200,200,200,1)"},{id:"RT",t:240,l:160,lbl:"S2",c:"rgba(200,200,200,1)"},{id:"LS",t:0,l:-20,lbl:"L3",c:"rgba(120,120,120,1)"},{id:"RS",t:0,l:460,lbl:"R3",c:"rgba(120,120,120,1)"},{id:"View",t:0,l:100,lbl:"-",c:"rgba(120,120,120,1)"},{id:"Menu",t:0,l:340,lbl:"+",c:"rgba(120,120,120,1)"}],map:{A:0,B:1,X:2,Y:3,LB:4,RB:5,LT:6,RT:7,View:8,Menu:9,LS:10,RS:11},iJ:["View","Menu","LS","RS"],hB:[]},g=document.getElementById("buttonGrid"),B={},f=a=>{const w=a.clientWidth;a.style.fontSize="40px";requestAnimationFrame(()=>{let f=parseInt(window.getComputedStyle(a).fontSize);for(;a.scrollWidth>w&&f>8;)a.style.fontSize=--f+"px"})};c.b.forEach(b=>{if(c.hB.includes(b.id))return;const d=document.createElement("div");d.className="btn",d.dataset.btn=b.id,d.textContent=b.lbl,d.style.top=b.t+"px",d.style.left=b.l+"px",d.style.background=b.c||c.bS.dC,d.style.borderColor=c.bS.bC,g.appendChild(d),B[b.id]=d}),Object.values(B).forEach(f);const s=document.getElementById("joystickHead");let G=null,L={};window.addEventListener("gamepadconnected",e=>G=e.gamepad.index),window.addEventListener("gamepaddisconnected",()=>G=null);function u(p){if(!p?.buttons)return s.style.transform="translate(-50%,-50%) scale(1)",s.textContent="",Object.values(B).forEach(b=>b.classList.remove("active")),void 0;for(const k in B){const i=c.map[k];if(void 0===i)continue;const v=!!p.buttons[i]?.pressed;B[k].classList.toggle("active",v),L[k]=v?performance.now():L[k]||0}let a=null,m=-1;for(const k in L)B[k].classList.contains("active")&&!c.iJ.includes(k)&&L[k]>m&&(m=L[k],a=k);a?(s.style.transform="translate(-50%,-50%) scale(1.3)",s.textContent=B[a].textContent,s.style.background=B[a].style.background,s.style.color="#000"):(s.style.transform="translate(-50%,-50%) scale(1)",s.textContent="",s.style.background="rgba(215,215,215,1)")}function dZ(x,y,d){const m=Math.hypot(x,y);return m<d?{x:0,y:0}:{x:x*(m-d)/(1-d)/m,y:y*(m-d)/(1-d)/m}}function cC(x,y){const m=Math.hypot(x,y);return m>1?{x:x/m,y:y/m}:{x,y}}function sXY(p){if(!p)return{x:0,y:0};let{x:x,y:y}=dZ(p.axes[0]||0,p.axes[1]||0,c.d);const u=p.buttons[12]?.pressed?1:0,d=p.buttons[13]?.pressed?1:0,l=p.buttons[14]?.pressed?1:0,r=p.buttons[15]?.pressed?1:0;x+=r-l,y+=d-u,c.i&&(y*=-1);return cC(x,y)}let sm={x:0,y:0},SM=0.95;function smXY(p){const t=sXY(p);return sm.x+=(t.x-sm.x)*SM,sm.y+=(t.y-sm.y)*SM,cC(sm.x,sm.y)}const dirs=[{x:0,y:-1},{x:1,y:-1},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:-1,y:1},{x:-1,y:0},{x:-1,y:-1}],nDirs=dirs.map(d=>{const m=Math.hypot(d.x,d.y);return{x:d.x/m,y:d.y/m}}),mks=Array.from({length:8},(_,i)=>document.getElementById("marker"+i));function cD(x,y){const m=Math.hypot(x,y);if(m<0.25)return-1;let b=-1,d=-Infinity;nDirs.forEach((v,i)=>{const dp=(x*v.x+y*v.y)/m;dp>d&&(d=dp,b=i)});return b}function uM(a){nDirs.forEach((v,i)=>{mks[i].style.left=50+v.x*45+"%",mks[i].style.top=50+v.y*45+"%",mks[i].classList.toggle("active",i===a)})}const cv=document.getElementById("stickCanvas"),ctx=cv.getContext("2d");let r=0;function rs(){const b=cv.getBoundingClientRect();cv.width=b.width,cv.height=b.height,r=Math.min(b.width,b.height)/2-10}rs(),window.addEventListener("resize",rs);const tr=[];function dT(x,y){tr.push({x,y}),tr.length>c.t&&tr.shift(),ctx.clearRect(0,0,cv.width,cv.height);const cx=cv.width/2,cy=cv.height/2;for(let i=1;i<tr.length;i++){const p0=tr[i-1],p1=tr[i],t=i/tr.length;ctx.beginPath(),ctx.moveTo(cx+p0.x*r,cy+p0.y*r),ctx.lineTo(cx+p1.x*r,cy+p1.y*r),ctx.lineWidth=20*(t/t),ctx.lineCap="round",ctx.strokeStyle="rgba(200,200,200,1)",ctx.shadowBlur=0,ctx.shadowColor="rgba(128,128,128,1)",ctx.stroke()}}function uH(x,y){s.style.left=50+x*45+"%",s.style.top=50+y*45+"%"}function loop(){const p=navigator.getGamepads()[G??0],t=smXY(p);dT(t.x,t.y);const{x,y}=sXY(p);uH(x,y),u(p),uM(cD(x,y)),requestAnimationFrame(loop)}requestAnimationFrame(loop);
</script>
</body>
</html>
